# 前端开发详细文档

### Login.vue：

表单数据绑定v-model，	

一、login登陆：
`async` 和 `await` 是 JavaScript 的异步编程语法糖，`async` 用于定义一个异步`await` 来等待一个 Promise 对象

箭头函数的基本语法是：`(参数) => { 函数体 }` 

异步函数必须使用 `async` 关键字声明：async (valid) => {
`await` 关键字只能在异步函数中使用，它会暂停异步函数的执行，直到等待的 Promise 对象解决或拒绝

```js
methods: {
    resetForm() {
      this.$refs.loginFormRef.resetFields() //调用引用对象的函数
    },
    login() {
     //参数 valid 是通过回调函数的方式传递进来的，valid，它的值是一个布尔值，表示表单是否验证通过
      this.$refs.loginFormRef.validate(async (valid) => {
        if (!valid) return this.$message.error('输入非法数据，请重新输入')
        const { data: res } = await this.$http.post('login', this.formdata) //提交给后台
        //console.log(res)
        if (res.status != 200) return this.$message.error(res.message)//非200返回错误
        window.sessionStorage.setItem('token', res.token) //浏览器session保存token
        this.$router.push('/index') //路由跳转
      })
    },
```

路由守卫routerjs，控制路由访问权限

```js
const router = new VueRouter({
  routes
})

//路由守卫，控制路由访问权限
router.beforeEach((to, from,next) => {
  const token = window.sessionStorage.getItem('token')
  if (to.path==='/login') return next() //请求登陆页面——放行
  //TODO 服务端验证token有效性
  if(!token){//其他页面，没有token
    next('/login') //跳转到登陆页面
  }else{
    next() //有token放行
  }
  return false
})
```

二、Layout布局

导入组件

```js
import Nav from '../components/admin/Nav.vue'
import Footer from '../components/admin/Footer.vue'
export default {
  name: "Admin",
  components:{Nav,Footer}
}
```

+引用，标签嵌套

```vue
<template>
  <a-layout id="components-layout-demo-basic">
      <Nav></Nav>
    <a-layout>
      <a-layout-header class="headerBtn">
        <Header></Header>
      </a-layout-header>
      <a-layout-content>
        <router-view :key="$route.fullPath"></router-view> 
      </a-layout-content>
      <a-layout-footer class="footer">
        <Footer></Footer>
      </a-layout-footer>
    </a-layout>
  </a-layout>
</template>

<script>
import Nav from '../components/admin/Nav.vue'
import Footer from '../components/admin/Footer.vue'
export default {
  name: "Admin",
  components:{Nav,Footer}
}
</script>
```

内容由路径决定：:key="$route.fullPath表示路由切换时要使用新的组件实例

   <a-layout-content>
<router-view :key="$route.fullPath"></router-view> 

路径对应组件：

```js
//页面路由组件
const Index = () =>import(/* webpackChunkName: "AddArt" */ '../components/article/Index.vue')
....
path: 'index',
component: Index,  //对应组件变量（存路径）
```

header 退出按钮：

![image-20230513200321811](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230513200321811.png)

```vue
<template>
  <a-button type="danger" @click="loginOut">退出</a-button>
</template>
<script>
export default {
  methods: {
    loginOut() {
      //清除token+返回登陆页面
      window.sessionStorage.clear('token')
      this.$router.push('/login')
    }
  }
}
</script>
```

### 其他常用组件：
Grid 栅格：通过`row`在水平方向建立一组`column`（简写col）
:gutter="16" 每列间隔

```vue
<a-row :gutter="16">
      <a-col class="gutter-row" :span="6">
        <div class="gutter-box">
          col-6
        </div>
      </a-col>
      <a-col class="gutter-row" :span="6">
        <div class="gutter-box">
          col-6
        </div>
      </a-col>
```

Pagination 分页器：


三、导航栏路由

点击路由跳转：

```vue
<a-menu-item key="addart">
          <a-icon type="form" />
          <span>写文章</span>
        </a-menu-item>
....js:
methods: {
    goToPage(item) {
      this.$router.push('/admin/' + item.key).catch((err) => err)
    },
  },
```

子页面路由绑定

```js
//页面路由组件
import Index from "@/components/admin/Index.vue";
const AddArt = () => import(/* webpackChunkName: "AddArt" */ '../components/article/AddArt.vue')
....
const routes = [
{
    path: '/admin',
    name: 'admin',
    component:Admin,
    children:[
      {
      path: 'index',  // ./admin/index
      component: Index,
      meta: {
        title: 'GinBlog 后台管理页面'
      }
    },
      {
        path: 'addart',//  ./admin/addart
        component: AddArt,
        meta: {
          title: '新增文章'
        }
      },

```

axios的请求拦截器——拦截所有请求，发送前配置 token，再请求

```js
axios.interceptors.request.use(config => {
  config.headers.Authorization = `Bearer ${window.sessionStorage.getItem('token')}`
  return config
})
```

四、用户页面User/UserList.vue   ***增删改查-范例***

1. 用户列表

   1.1 分页查询

   ```js
   created() {//钩子函数，创建时执行查询
       this.getUserList()
     },
   ```

   ```js
    // 获取用户列表
       async getUserList() {
         //发送请求
         const { data: res } = await this.$http.get('user/users', {
           params: {//分页器
             username: this.queryParam.username,
             pagesize: this.queryParam.pagesize,
             pagenum: this.queryParam.pagenum,
           },
         })
         console.log(res)
         //返回处理
         if (res.status != 200) return this.$message.error(res.message)
         this.userlist = res.data
         this.pagination.total = res.total
       },
   ```

   绑定的组件：

   ```vue
   <a-table
           rowKey="ID"
           :columns="columns"
           :pagination="pagination"//分页器
           :dataSource="userlist"
           bordered
           @change="handleTableChange"
         >
     //数据映射显示,绑定role
      <span slot="role" slot-scope="data">{{data == 1 ? '管理员':'订阅者'}}</span>
     
    ...js:
   const columns = [{
       title: '角色',
       dataIndex: 'role',
       width: '20%',
       key: 'role',
       align: 'center',
      scopedSlots: { customRender: 'role' },
   ```

   queryParam——Ant Design 分页器绑定的数据

   ```js
   export default {
     data() {
       return {
         //Ant-分页器参数
          queryParam: {
           username: '',
           pagesize: 5,
           pagenum: 1,
         },
   ```

   ```js
   // 更改分页
   handleTableChange(pagination, filters, sorter) {
     var pager = { ...this.pagination }
     pager.current = pagination.current
     pager.pageSize = pagination.pageSize
     this.queryParam.pagesize = pagination.pageSize
     this.queryParam.pagenum = pagination.current
   
     if (pagination.pageSize !== this.pagination.pageSize) {
       this.queryParam.pagenum = 1
       pager.current = 1
     }
     this.pagination = pager
     this.getUserList()
   },
   ```

   +单个模糊查询，后端修改

   ```go
   // 分页查询+单个模糊查询
   func GetUsers(username string, pageSize int, pageNum int) ([]User, int64) {
      var users []User
      var total int64
   
      offset := (pageNum - 1) * pageSize
      if pageSize == -1 && pageNum == -1 {
         offset = -1
      }
      if username == "" {
         err = db.Limit(pageSize).Offset(offset).Find(&users).Count(&total).Error //gorm的limit实现的分页查询
      } else {
         err = db.Where("username LIKE ?", username+"%").Limit(pageSize).Offset(offset).Find(&users).Count(&total).Error //gorm的limit实现的单个模糊查询
      }
      if err != nil {
         return nil, 0
      }
      return users, total
   }
   ```

   API user.go 

   ```go
   username := c.Query("username")
   ....
   data, total := model.GetUsers(username, pageSize, pageNum) //调用service分页查询
   ```

   按username模糊搜索，函数还是getUserList

   ```vue
   <a-input-search
     v-model="queryParam.username"
     placeholder="输入用户名查找"
     enter-button
     allowClear
     @search="getUserList"
   />
   ```

   

   1.2 改+删

   组件 编辑+删除+重置

   ```vue
   <template slot="action" slot-scope="data">
     <div class="actionSlot">
       <a-button
         type="primary"
         icon="edit"
         style="margin-right:15px"
         @click="editUser(data.ID)"
       >编辑</a-button>
       <a-button
         type="danger"
         icon="delete"
         style="margin-right:15px"
         @click="deleteUser(data.ID)"
       >删除</a-button>
       <a-button type="info" icon="info" @click="updatePass(data.ID)">重置</a-button>
     </div>
   </template>
   ```

   删除：

   ```js
   // 删除用户
   deleteUser(id) {
     this.$confirm({
       title: '提示：请再次确认',
       content: '确定要删除该用户吗？一旦删除，无法恢复',
       onOk: async () => {
         const { data: res } = await this.$http.delete(`user/${id}`)
         if (res.status != 200) return this.$message.error(res.message)
         this.$message.success('删除成功')
         this.getUserList()
       },
       onCancel: () => {
         this.$message.info('已取消删除')
       },
     })
   },
   ```

   新增：

   后端添加：查询单个用户。

   ```go
   // 查询用户 service层 User.go
   func GetUser(id int) (User, int) {
      var user User
      err := db.Where("ID = ?", id).First(&user).Error
      if err != nil {
         return user, errmsg.ERROR
      }
      return user, errmsg.SUCCSE
   }
   ```

   ```go
   // 查询单个用户 API/user.go control层调用服务
   func GetUserInfo(c *gin.Context) {
      id, _ := strconv.Atoi(c.Param("id"))
      var maps = make(map[string]interface{})
      data, code := model.GetUser(id)
      maps["username"] = data.Username
      maps["role"] = data.Role
      c.JSON(
         http.StatusOK, gin.H{
            "status":  code,
            "data":    data,
            "total":   1,
            "message": errmsg.GetErrMsg(code),
         },
      )
   
   }
   ```

   添加到路由解析：router.go

   ```go
   router.GET("user/:id", v1.GetUserInfo)
   ```

   添加用户接口实现

   

   前端：

   浮动表单

   ![image-20230516224727191](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230516224727191.png)

   Modal 对话框<a-modal>

   表单绑定数据：

   ```vue
   <a-form-model :model="newUser" :rules="addUserRules" ref="addUserRef">
   ```

   ```js
   export default {
     data() {
       return {
         。。。。
         //添加用户
         newUser: {
           username: '',
           password: '',
           role: 2,
           checkPass: '',
         },
         //查询用户
         userInfo: {
           username: '',
           password: '',
           role: 2,
           checkPass: '',
         },
   ```

   绑定添加用户js函数：addUserOk

   ```js
   // 新增用户
   addUserOk() {
     this.$refs.addUserRef.validate(async (valid) => {
       if (!valid) return this.$message.error('参数不符合要求，请重新输入')
       const { data: res } = await this.$http.post('user/add', {
         username: this.newUser.username,
         password: this.newUser.password,
         role: this.newUser.role,
       })
       if (res.status != 200) return this.$message.error(res.message)
       this.$refs.addUserRef.resetFields()
       this.addUserVisible = false
       this.$message.success('添加用户成功')
       this.getUserList()
     })
   },
   ```

   编辑

   表单：

   ![image-20230516230619156](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230516230619156.png)

   ```js
   // 编辑用户 get表单内容
   async editUser(id) {
     this.editUserVisible = true
     const { data: res } = await this.$http.get(`user/${id}`)
     this.userInfo = res.data
     this.userInfo.id = id
   },
   //提交 编辑后数据，username+role
   editUserOk() {
         this.$refs.addUserRef.validate(async (valid) => {
           if (!valid) return this.$message.error('参数不符合要求，请重新输入')
           const { data: res } = await this.$http.put(`user/${this.userInfo.id}`, {
             username: this.userInfo.username,
             role: this.userInfo.role,
           })
           if (res.status != 200) return this.$message.error(res.message)
           this.editUserVisible = false
           this.$message.success('更新用户信息成功')
           this.getUserList()
         })
       },
   ```

   重置密码：TODO ——修改 updatePass(data.ID)

   ```vue
   <a-button type="info" icon="info" @click="updatePass(data.ID)">重置</a-button>
   ```

五、分类页面和文章页面——还是增删改查，相同的不细分析

5.1 分类列表页面：

查询单个用户：
后端添加：service层+control层+配置路由

```go
router.GET("category/:id", v1.GetCateInfo)
。。。。
func GetCateInfo(c *gin.Context) {
	data, code := model.GetCateInfo(id)
。。。。
func GetCateInfo(id int) (Category, int) {
	var cate Category
	db.Where("id = ?", id).First(&cate)
	return cate, errmsg.SUCCSE
}

```

5.2 文章列表页面

不同：新增和编辑跳转到写文章页面进行操作
添加：
缩略图：

```vue
<a-table :columns="columns" :pagination="pagination" :dataSource="Artlist">
<span class="ArtImg" slot="img" slot-scope="img">
  <img :src="img" />
</span>
```

```js
{
  title: '缩略图',
  dataIndex: 'img',//Artilist的img属性
  width: '20%',
  key: 'img',
  align: 'center',
  scopedSlots: { customRender: 'img' },
},
。。。
data：
Artlist: [],
。。。
this.Artlist = res.data
```

![image-20230517162730948](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230517162730948.png)

注意：七牛云的oss外链只支持最高免费24h，过期了要手动更换

![image-20230517162838860](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230517162838860.png)

按分类筛选:select选择器

```vue
<a-col :span="3">
  <a-select placeholder="请选择分类" style="width:200px" @change="CateChange">
    <a-select-option v-for="item in Catelist" :key="item.id" :value="item.id">{{item.name}}</a-select-option>
  </a-select>
```

```js
this.getCateList()//获取分类信息
。。。
 // 查询分类下的文章
CateChange(value) {
      this.getCateArt(value)
    },
    async getCateArt(id) {
      const { data: res } = await this.$http.get(`article/list/${id}`, {
        params: { pagesize: this.queryParam.pagesize, pagenum: this.queryParam.pagenum },
      })
      if (res.status !== 200) return this.$message.error(res.message)
      this.Artlist = res.data
      this.pagination.total = res.total
    },
```

六、写文章页面：编辑 or 新增

Artlist.Vue点击按钮跳转，编辑要有ID

```vue
<a-button type="primary" @click="$router.push('/addart')">新增</a-button>
 <a-button @click="$router.push(`/addart/${data.ID}`)"  >编辑</a-button>
```

![image-20230517184714120](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230517184714120.png)

id存在：编辑文章，获取对应文章信息

```vue
<h3>{{id? '编辑文章':'新增文章'}}</h3>
```

```js
created() {
  this.getCateList()
  this.headers = { Authorization: `Bearer ${window.sessionStorage.getItem('token')}` }
  if (this.id) {
    this.getArtInfo(this.id)
  }
},
```

上传图片：组件upload 

```vue
<a-upload
  listType="picture"
  :defaultFileList="fileList"
  name="file"
  :action="upUrl"
  :headers="headers"
  @change="upChange"
>
```

```js
// 上传图片
upChange(info) {
  if (info.file.status !== 'uploading') {
  }
  if (info.file.status === 'done') {
    this.$message.success(`图片上传成功`)
    const imgUrl = info.file.response.url
    this.artInfo.img = imgUrl
  } else if (info.file.status === 'error') {
    this.$message.error(`图片上传失败`)
  }
},
```

提交&&更新文章

```js
artOk(id) {
  this.$refs.artInfoRef.validate(async (valid) => {
    if (!valid) return this.$message.error('参数验证未通过，请按要求录入文章内容')
    if (id === 0) {
      const { data: res } = await this.$http.post('article/add', this.artInfo)
      if (res.status !== 200) return this.$message.error(res.message)
      this.$router.push('/artlist')
      this.$message.success('添加文章成功')
    } else {
      const { data: res } = await this.$http.put(`article/${id}`, this.artInfo)
      if (res.status !== 200) return this.$message.error(res.message)

      this.$router.push('/artlist')
      this.$message.success('更新文章成功')
    }
  })
},
```

七、富文本编辑器——文章编辑器 TinyMCE ——以后考虑markdown编辑器如mavonEditor

![image-20230517191645160](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230517191645160.png)

```vue
<a-form-model-item label="文章内容" prop="content">
  <Editor v-model="artInfo.content"></Editor>
</a-form-model-item>
。。。。
import Editor from '../editor/index'
```

![image-20230517192729077](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230517192729077.png)

核心修改配置文件index.vue

八、vue——admin打包配置

Vue.config.js ——参考vue CLI文档

部署到后端

```js
module.exports = {
  publicPath: '/',
  outputDir: 'dist',
  //警告 webpack 的性能提示
  configureWebpack: {
    performance: {
      hints: 'warning',
      //入口起点的最大体积 整数类型（以字节为单位）
      maxEntrypointSize: 50000000,
      //生成文件的最大体积 整数类型（以字节为单位 300k）
      maxAssetSize: 30000000,
      //只给出 js 文件的性能提示
      assetFilter: function(assetFilename) {
        return assetFilename.endsWith('.js')
      }
    }
  }
}
```

执行打包命令：yarn build 

```js
//package.json配置脚本命令
"scripts": {
  "serve": "vue-cli-service serve",
  "build": "vue-cli-service build",
  "lint": "vue-cli-service lint"
},
```

yarn build生成打包文件夹dist含前端静态资源内容

后将dist内容复制进后端static文件夹下



后端添加前端的静态资源托管

![image-20230531193503923](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230531193503923.png)



八、部署在云服务器

后端：数据库配置——连接数据库

前端：重新打包

http.js 前端修改请求后端的位置路径头：

![image-20230531191942706](/Users/luo/Desktop/ginVueBlog-main/前端开发文档picture/:Users:luo:Library:Application Support:typora-user-images:image-20230531191942706.png)
